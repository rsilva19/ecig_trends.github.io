---
title: "Rebecca Graphs"
author: "Rebecca Silva"
date: "11/11/2019"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(viridis)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	message = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
theme_set(theme_minimal() + theme(legend.position = "bottom"))
```


# Explore relationships between belief of harm of ecigs and trying to quit smoking cigarettes
```{r}
# clean 
clean_data = 
  ecig_data %>%
  mutate(harm_ecigs = recode(harm_ecigs, "equally addictive" = "equally", "less addictive" = "less", "more addictive" = "more"), 
         ecigs_past_month = factor(ecigs_past_month, c(NA, "0", "1-2", "3-5", "6-9", "10-19", "20-29", "30")))
```

# Explore harm_ecigs 
How harmful are e-cigs compared to regular cigarettes: 
harm_ecigs: levels = "less", "equally", "more", "never heard of e-cigs", "unknown"

```{r}

# filter non smokers and na
plot_data = 
  clean_data %>% 
  filter( !is.na(quit_cig) , quit_cig != "not a smoker" ) %>% 
  filter( !is.na(harm_ecigs) )


# get prop from each year
prop_data = 
  plot_data %>% 
  group_by(year, harm_ecigs) %>% 
  summarize(n = n()) %>% 
  mutate(prop = n/sum(n)) 
  
# stacked - choose only less, equally and more
prop_data %>% 
  filter( harm_ecigs =="less"| harm_ecigs =="equally" | harm_ecigs =="more") %>%
  filter( year != "2013", year != "2015") %>% 
  ggplot() +
  geom_col(aes(x = year, y = prop, fill = harm_ecigs), position = "stack")
  
# grouped
prop_data %>%
  mutate(harm_ecigs = factor(harm_ecigs, c("less", "equally", "more", "never heard of e-cigs", "unknown"))) %>% 
  filter( harm_ecigs =="less"| harm_ecigs =="equally" | harm_ecigs =="more") %>%
  filter( year != "2013", year != "2015") %>% 
  ggplot(aes( x = year, y = prop, fill = harm_ecigs)) + 
  geom_bar(position ="dodge", stat ="identity") +
  scale_fill_viridis(discrete = T) +
  labs(
    title = "Perception of Harmfullness of E-Cigarettes Compared to Cigarettes",
    x = "Year",
    y = "Proportion of Belief") +
  theme(plot.title = element_text(hjust = 0.5))
```


# Exploring quit_cig and Explore ecigs_past_month 

Are you trying to quit cigarettes? 
quit_cig: levels = "not a smoker", "next 30 days", "next 6 months", "within 1 year", "over 1 year", "no"

Number of days used e-cigs in past 30 days 
ecigs_past_month: (“Inconsistent” and missing are NA) 

```{r}
# first look at one year
clean_data %>% 
  filter(quit_cig != "not a smoker", !is.na(quit_cig), !is.na(ecigs_past_month), year == "2015") %>% # want only cig smokers to compare
  group_by(quit_cig, ecigs_past_month) %>% 
  summarise(n= n()) %>% 
  mutate(prop = n/sum(n)) %>% 
  ggplot(aes( x = quit_cig, y = prop, fill = ecigs_past_month)) + 
  geom_bar(position ="dodge", stat ="identity") +
  scale_fill_viridis(discrete = T)

# 2015 - 2018
clean_data %>% 
  mutate(ecigs_past_month = recode(ecigs_past_month, "1-2" = "1-9", # condensing catergories 
                                   "3-5" = "1-9", 
                                   "6-9" = "1-9", 
                                   "30" = "20-30", 
                                   "20-29" = "20-30"),
         quit_cig = factor(quit_cig, c(NA, "not a smoker", "next 30 days", "next 6 months", "within 1 year", "over 1 year", "no"))) %>%  
  filter( year %in% c("2015", "2016", "2017" , "2018")) %>% 
  filter(quit_cig != "not a smoker",  # only somkers because interested in quiting 
         !is.na(quit_cig), 
         !is.na(ecigs_past_month)) %>%
  group_by(quit_cig, ecigs_past_month, year) %>% 
  summarise(n= n()) %>% 
  mutate(prop = n/sum(n)) %>% 
  ggplot(aes( x = quit_cig, 
              y = prop, 
              fill = ecigs_past_month)) + 
  geom_bar(position ="dodge", 
           stat ="identity") +
  facet_wrap(~year) +
  theme(legend.position = "bottom", 
        axis.text.x = element_text(angle = 90), 
        plot.title = element_text(hjust = .5)) +
  scale_fill_viridis(discrete = T) +
  labs(
    title = "E-Cig Use with proportion eagerness \n to quit smoking cigarettes",
    x = "When are you trying to quit?",
    y = "Proportion", 
    fill = "Ecig frequency/month") 
  
```



# Weighted graphs 

```{r}
#creating survey object 
library(srvyr)
srv_ecig = ecig_data %>% 
  mutate(id = row_number()) %>% 
   as_survey_design(id = id, wt = as.numeric(weight) )
```


```{r}
#plot of harmful vs year 
srv_ecig %>% 
  filter( !is.na(quit_cig) , quit_cig != "not a smoker" ) %>% 
  filter( !is.na(harm_ecigs) ) %>%
  mutate(harm_ecigs = recode(harm_ecigs, "equally addictive" = "equally", "less addictive" = "less", "more addictive" = "more"), 
         ecigs_past_month = factor(ecigs_past_month, c(NA, "0", "1-2", "3-5", "6-9", "10-19", "20-29", "30"))
         ) %>% 
  filter( harm_ecigs =="less"| harm_ecigs =="equally" | harm_ecigs =="more") %>%
  filter( year != "2013", year != "2015") %>% 
  mutate(harm_ecigs = fct_relevel(harm_ecigs, c("less", "equally", "more"))) %>% 
  group_by(year, harm_ecigs) %>% 
  summarize(n = survey_total()) %>% 
  mutate(prop = n/sum(n)) %>% 
  ggplot(aes( x = year, y = prop, fill = harm_ecigs)) + 
  geom_bar(position ="dodge", stat ="identity") +
  scale_fill_viridis(discrete = T) +
  labs(
    title = "Perception of Harmfullness of E-Cigarettes Compared to Cigarettes",
    x = "Year",
    y = "Proportion of Belief") +
  theme(plot.title = element_text(hjust = 0.5))
```


```{r}
#plot of ecig use and quit cigs
row = nrow(ecig_data)
srv_ecig %>% 
  mutate(one = rep(1, row),
         quit_cig = fct_relevel(quit_cig, c("not a smoker", "next 30 days", "next 6 months", "within 1 year", "over 1 year", "no"))) %>% 
  filter(quit_cig != "not a smoker") %>% 
  filter(!is.na(quit_cig), !is.na(ecigs_past_month)) %>% 
  filter(year %in% c("2015", "2016", "2017" , "2018")) %>% 
  group_by(quit_cig, ecigs_past_month, year) %>% 
  summarise(n = survey_total(one)) %>% 
  mutate(prop = n/sum(n)) %>% 
  ggplot(aes( x = quit_cig, 
              y = prop, 
              fill = ecigs_past_month)) + 
  geom_bar(position ="dodge", 
           stat ="identity") +
  facet_wrap(~year) + 
  theme(legend.position = "bottom", 
        axis.text.x = element_text(angle = 90), 
        plot.title = element_text(hjust = .5)) +
  scale_fill_viridis(discrete = T) +
  labs(
    title = "E-Cig Use with proportion eagerness \n to quit smoking cigarettes",
    x = "When are you trying to quit?",
    y = "Proportion", 
    fill = "Ecig frequency/month") 
```


